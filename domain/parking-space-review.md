# 停車位數量檢討

## 問題背景

建築設計中需要針對不同類型的停車位進行數量檢討，確保：
1. 符合法規要求的最低設置數量（法定、無障礙等）。
2. 設計數量與送審資料一致。
3. 能夠快速分類並輸出統計報表。

Revit 中的停車位通常使用 `Parking` (停車場) 類別的元件，但預設缺乏明確的分類參數，需定義標準化流程。

## 停車位分類

依照設計需求，停車位分為以下八大類：

| 分類名稱 | 說明 | Revit 識別建議 |
| :--- | :--- | :--- |
| **法定停車位** | 依建築技術規則需設置之基本車位 | 參數 `停車位類型` = "法定" |
| **無障礙停車位** | 供行動不便者使用，需符合特定尺寸 | 參數 `停車位類型` = "無障礙" (或檢查族群名稱) |
| **增設停車位** | 法規要求以外額外設置之車位 | 參數 `停車位類型` = "增設" |
| **裝卸車位** | 供貨車裝卸貨使用 | 參數 `停車位類型` = "裝卸" |
| **獎勵停車位** | 依各類獎勵法規（如都更、容積移轉）增設 | 參數 `停車位類型` = "獎勵" |
| **機車停車位** | 一般機車停放空間 | 參數 `停車位類型` = "機車" |
| **無障礙機車停車位** | 供行動不便者使用之機車位 | 參數 `停車位類型` = "無障礙機車" |
| **大客車停車位** | 供大型客車停放 | 參數 `停車位類型` = "大客車" |

## 法定停車位需求計算

根據「建築技術規則」，法定停車位數量需依據「總樓地板面積」扣除免計項目後，按建築用途與都市計畫區域進行計算。

### 1. 樓地板面積計算原則

**計算基準：**
總樓地板面積（不包含下列免計項目）：
1.  室內停車空間面積
2.  法定防空避難設備面積
3.  騎樓、門廊、外廊等無牆壁之面積
4.  機械房、變電室、蓄水池、屋頂突出物等類似用途部分

### 2. 建築用途分類與設置標準

| 分類 | 用途說明 | 都市計畫 **內** 標準 | 都市計畫 **外** 標準 |
| :--- | :--- | :--- | :--- |
| **第一類** | 戲院、演藝場、集會堂、商場、餐廳、辦公室、金融業、旅館、遊藝場等 | 300 平方公尺 以下免設<br>超過部分每 **150** 平方公尺 設 1 輛 | 300 平方公尺 以下免設<br>超過部分每 **250** 平方公尺 設 1 輛 |
| **第二類** | 住宅、集合住宅 | 500 平方公尺 以下免設<br>超過部分每 **150** 平方公尺 設 1 輛 | 500 平方公尺 以下免設<br>超過部分每 **300** 平方公尺 設 1 輛 |
| **第三類** | 博物館、美術館、圖書館、醫院、體育館、社福設施、殯儀館等 | 500 平方公尺 以下免設<br>超過部分每 **200** 平方公尺 設 1 輛 | 500 平方公尺 以下免設<br>超過部分每 **350** 平方公尺 設 1 輛 |
| **第四類** | 倉庫、學校、幼兒園、車輛修理、工廠、屠宰場等 | 500 平方公尺 以下免設<br>超過部分每 **250** 平方公尺 設 1 輛 | 500 平方公尺 以下免設<br>超過部分每 **350** 平方公尺 設 1 輛 |

### 3. 計算公式範例

$$
\text{應設車位數} = \lceil \frac{\text{總樓地板面積} - \text{免計面積} - \text{免設門檻}}{\text{每輛設置基準}} \rceil
$$

*註：計算結果採 **無條件進位**（即計算結果有小數點時，應增設一輛）。*

### 4. 多用途建築檢討原則

若同一幢建築物包含二類以上用途，計算原則如下：

1.  **分別計算，免設部分擇一適用**：
    *   各類用途依其標準分別計算應設車位數。
    *   計算過程中，「免設門檻」（如 300 平方公尺以下免設）僅能扣除 **一次**。通常選擇對申請最有利（即扣除面積最大）的類別適用。

2.  **未達標準合併計算**：
    *   若某類用途面積未達其設置標準（門檻），應將該類面積併入其他類別計算。
    *   合併計算時，應採用 **較高標準**（即分母較小、要求較嚴格者）進行檢討。

    > **範例說明**：
    > 若某建築含有用途 A（標準每 150 平方公尺設 1 輛）與用途 B（標準每 250 平方公尺設 1 輛）。
    > 若用途 B 之面積未達設置標準（例如僅 100 平方公尺），則將其 100 平方公尺併入用途 A 計算，並採用用途 A 之標準（較高標準 1/150）。

### 5. 特殊用途規定（國際觀光旅館）

針對「國際觀光旅館」之特殊規定：

1.  **大客車設置標準**：
    *   按客房數計算：每滿 **50 間** 客房，應設置 **1 輛** 大客車停車位。
    *   設置位置：需位於基地地面層或法定空地上。

2.  **法定停車位減設優惠**：
    *   每設置 1 輛大客車停車位，可減設 **3 輛** 法定停車位（小汽車）。
    *   計算時應先算出總法定停車位需求，再扣除大客車折抵數量。

## 檢討流程與邏輯

1.  **資料標準化**：
    *   確認所有停車位元件皆具備 `停車位類型` (Text) 參數。
    *   若無參數，需先建立或使用既有文字參數（如 `Comments`/`註解`）。

2.  **自動檢查**：
    *   掃描專案中所有 Category 為 `OST_Parking` 的元素。
    *   讀取其分類參數值。
    *   統計各類型數量。

3.  **異常排除**：
    *   標記未分類的停車位（參數空白）。
    *   標記分類名稱不符標準的停車位。

## 工具設計草案

建議開發以下 MCP 工具來輔助檢討：

```javascript
// 取得停車位統計資訊
get_parking_statistics()
→ 回傳：
  {
    "法定": 50,
    "無障礙": 2,
    "增設": 10,
    "裝卸": 1,
    "大客車": 2,
    "獎勵": 5,
    "機車": 20,
    "無障礙機車": 1,
    "未分類": 3,
    "總計": 92
  }

// 檢查特定類型停車位列表
list_parking_spaces(type="無障礙")
→ 回傳：
  [
    { "id": 12345, "location": "B1", "mark": "101" },
    { "id": 12346, "location": "B1", "mark": "102" }
  ]

// 批次設定停車位類型 (輔助用)
set_parking_type(element_ids=[...], type="法定")

// 計算應設法定停車位 (新功能)
calculate_required_statutory_parking(
  area_total=5000, 
  area_exclude=500, 
  usage_category=2, 
  is_urban_planning=true
)
→ 回傳：
  {
    "effective_area": 4500, // 5000 - 500
    "threshold": 500,
    "divisor": 150,
    "required_count": 27 // (4500-500)/150 = 26.66... -> 27
  }
```
